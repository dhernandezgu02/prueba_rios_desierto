# Docker Compose para Sistema de Gestión de Clientes - Falabella
# Configurado para usar SQLite3 como base de datos

services:
  # Backend Django con SQLite3
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: falabella_backend
    environment:
      - DEBUG=False
      - SECRET_KEY=django-insecure-falabella-production-change-this-key-2025
      - ALLOWED_HOSTS=localhost,127.0.0.1,backend,falabella_backend
      - CORS_ALLOWED_ORIGINS=http://localhost:3000,http://frontend:80
      - DB_NAME=falabella_clientes.sqlite3
      - DB_ENGINE=django.db.backends.sqlite3
    volumes:
      - ./backend:/app
      - sqlite_data:/app/data
    ports:
      - "8000:8000"
    restart: unless-stopped
    networks:
      - falabella_network

  # Frontend React
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        REACT_APP_API_BASE_URL: http://localhost:8000/api
        GENERATE_SOURCEMAP: false
    container_name: falabella_frontend
    ports:
      - "3000:80"
    depends_on:
      - backend
    restart: unless-stopped
    networks:
      - falabella_network

# Volúmenes persistentes
volumes:
  sqlite_data:

# Red personalizada
networks:
  falabella_network:
    driver: bridge